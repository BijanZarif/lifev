# -*- autoconf -*-
# 
#
AC_INIT([lifev], [0.6.99@CVSDATE@], [lifev-dev@webmail.mate.polimi.it])
#AC_INIT([lifev], [0.7.0], [lifev-dev@webmail.mate.polimi.it])

LIFEV_VERSION_MAJOR=0
LIFEV_VERSION_MINOR=6
LIFEV_VERSION_MICRO=99
LIFEV_VERSION_EXTRA=@CVSDATE@
AC_SUBST(LIFEV_VERSION_MAJOR)
AC_SUBST(LIFEV_VERSION_MINOR)
AC_SUBST(LIFEV_VERSION_MICRO)
AC_SUBST(LIFEV_VERSION_EXTRA)
AC_DEFINE_UNQUOTED(LIFEV_VERSION_MAJOR,$LIFEV_VERSION_MAJOR,[major version number])
AC_DEFINE_UNQUOTED(LIFEV_VERSION_MINOR,$LIFEV_VERSION_MINOR,[minor version number])
AC_DEFINE_UNQUOTED(LIFEV_VERSION_MICRO,$LIFEV_VERSION_MICRO,[micro version number])
AC_DEFINE_UNQUOTED(LIFEV_VERSION_EXTRA,$LIFEV_VERSION_EXTRA,[extra version information: date, cvs, ...])

LIFEV_PACKAGE=lifev
LIFEV_VERSION=${LIFEV_VERSION_MAJOR}.${LIFEV_VERSION_MINOR}.${LIFEV_VERSION_MICRO}${LIFEV_VERSION_EXTRA}

AC_DEFINE_UNQUOTED(LIFEV_VERSION_STRING,["${LIFEV_VERSION_MAJOR}.${LIFEV_VERSION_MINOR}.${LIFEV_VERSION_MICRO} (${LIFEV_VERSION_EXTRA})"],[LifeV version string])


PACKAGE=$LIFEV_PACKAGE
VERSION=$LIFEV_VERSION

AC_SUBST(LIFEV_PACKAGE)
AC_SUBST(LIFEV_VERSION)



AC_CONFIG_AUX_DIR(admin)

dnl What the current system and host
AC_CANONICAL_HOST
AC_CANONICAL_SYSTEM


AM_INIT_AUTOMAKE([foreign 1.7.8 dist-bzip2])
AM_CONFIG_HEADER(lifeconfig.h)

LIFEV_CHECK_COMPILERS


# no need for static libs 
AC_DISABLE_STATIC
AC_PROG_LIBTOOL

AC_CHECK_TYPE(size_t, unsigned)

AC_LANG_SAVE
AC_LANG_CPLUSPLUS

AC_MSG_CHECKING(for size_t == uint)
AC_TRY_RUN([
return sizeof(size_t)==sizeof(uint);
],
[
   AC_MSG_RESULT(yes)
   size_t_same_as_uint=yes
   AC_DEFINE(LIFEV_SIZET_SAME_AS_UINT, 1, [sizeof(size_t)==sizeof(uint)])
],
[
  AC_MSG_RESULT(no)
  size_t_same_as_uint=no
])
AC_LANG_RESTORE

# pdflatex
AC_CHECK_PROG(PDFLATEX, pdflatex,[pdflatex],[no])

# doxygen
AC_CHECK_PROG(DOXYGEN, doxygen, [doxygen], [no-doxygen] )
AC_CHECK_PROG(LIFE_HAS_DOT, dot, [yes] )


AC_CHECK_BOOST
AC_CHECK_BOOST_GRAPH
AC_CHECK_BOOST_SIGNALS
AC_CHECK_BOOST_REGEX
AC_CHECK_BOOST_UNIT_TEST_FRAMEWORK

AC_CHECK_BOOST_PROGRAM_OPTIONS
AM_CONDITIONAL(HAVE_BOOST_PROGRAM_OPTIONS, test "x$boost_program_options_error" = "xno")


dnl
dnl checks for some scientific computing libraries
dnl 
dnl libm
AC_CHECK_LIB(m,cos,[LIBS="-lm ${LIBS}"],${LIBS})
dnl umfpack
# disable it for not since it is not used yet: need to check for "NO"
# AC_CHECK_UMFPACK(4.3.0) # at least umfpack 4.3
AM_CONDITIONAL(HAVE_UMFPACK, test "x$umfpack_libs" != "x" )

dnl lapack, blas, g2c
AC_CHECK_LAPACK
AC_CHECK_UMFPACK
AM_CONDITIONAL(HAVE_UMFPACK, test "x$umfpack_libs" != "x" )

dnl aztec
AC_CHECK_AZTEC
dnl petsc
AC_CHECK_PETSC(2.1.6) #
AM_CONDITIONAL(HAVE_PETSC, test "x$petsc_libs" != "x" )

dnl parmetis
AC_CHECK_PARMETIS

dnl grace 
AC_CHECK_HEADERS([grace_np.h])
AC_CHECK_LIB([grace_np],GraceClose,[grace_libs="-lgrace_np"],[grace_libs=""])
AC_SUBST(grace_libs)


#all_includes="-I\$(top_srcdir) -I\$(top_srcdir)/life/lifecore -I\$(top_srcdir)/life/lifearray  -I\$(top_srcdir)/life/lifemesh -I\$(top_srcdir)/life/lifealg  -I\$(top_srcdir)/life/lifefem -I\$(top_srcdir)/life/lifesolver -I\$(top_srcdir)/life/lifefilters"
#AC_SUBST(all_includes)

CPPFLAGS="-I\$(top_srcdir) ${CPPFLAGS}"

life_libs="\$(top_builddir)/life/lifefilters/liblifefilters.la \$(top_builddir)/life/lifesolver/liblifesolver.la  \$(top_builddir)/life/lifefem/liblifefem.la \$(top_builddir)/life/lifealg/liblifealg.la \$(top_builddir)/life/lifemesh/liblifemesh.la \$(top_builddir)/life/lifearray/liblifearray.la \$(top_builddir)/life/lifecore/liblifecore.la"

#life_libs="\$(top_builddir)/life/lifefilters/liblifefilters.la  \$(top_builddir)/life/lifesolver/liblifesolver.la \$(top_builddir)/life/lifefem/liblifefem.la \$(top_builddir)/life/lifealg/liblifealg.la \$(top_builddir)/life/lifemesh/liblifemesh.la \$(top_builddir)/life/lifearray/liblifearray.la \$(top_builddir)/life/lifecore/liblifecore.la"

#life_libs="\$(top_builddir)/life/lifefilters/liblifefilters.la  \$(top_builddir)/life/lifefem/liblifefem.la \$(top_builddir)/life/lifealg/liblifealg.la \$(top_builddir)/life/lifearray/liblifearray.la \$(top_builddir)/life/lifemesh/liblifemesh.la \$(top_builddir)/life/lifecore/liblifecore.la"

AC_SUBST(life_libs)
LIFEV_LIBS="-llifefilters -llifesolver -llifefem -llifealg -llifemesh -llifearray -llifecore"


#
# setting prefix
#  
prefix=${prefix:-"/usr"}
if test "x${prefix}" = "xNONE"; then
    prefix=/usr
fi


dnl testdir
AC_CONFIG_TESTDIR(testsuite)

dnl pkgconfig
AX_CREATE_PKGCONFIG_INFO(life.pc,,[${LIFEV_LIBS} $LIBS],[Finite Element Library and more],[$CPPFLAGS $CFLAGS])


